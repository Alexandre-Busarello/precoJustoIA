generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id                          String                       @id @default(cuid())
  name                        String?
  email                       String                       @unique
  emailVerified               DateTime?
  image                       String?
  password                    String?
  subscriptionTier            SubscriptionTier             @default(FREE)
  premiumExpiresAt            DateTime?
  firstPremiumAt              DateTime?                    @map("first_premium_at")
  lastPremiumAt               DateTime?                    @map("last_premium_at")
  premiumCount                Int                          @default(0) @map("premium_count")
  wasPremiumBefore            Boolean                      @default(false) @map("was_premium_before")
  stripeCurrentPeriodEnd      DateTime?                    @map("stripe_current_period_end")
  stripeCustomerId            String?                      @unique @map("stripe_customer_id")
  stripePriceId               String?                      @map("stripe_price_id")
  stripeSubscriptionId        String?                      @unique @map("stripe_subscription_id")
  isAdmin                     Boolean                      @default(false) @map("is_admin")
  earlyAdopterDate            DateTime?                    @map("early_adopter_date")
  inactivatedAt               DateTime?                    @map("inactivated_at")
  isEarlyAdopter              Boolean                      @default(false) @map("is_early_adopter")
  isInactive                  Boolean                      @default(false) @map("is_inactive")
  lastLoginAt                 DateTime?                    @map("last_login_at")
  acquisition                 String?                      @map("acquisition")
  createdAt                   DateTime                     @default(now()) @map("created_at")
  lastOnboardingSeenAt        DateTime?                    @map("last_onboarding_seen_at")
  onboardingAcquisitionSource String?                      @map("onboarding_acquisition_source")
  onboardingExperienceLevel   String?                      @map("onboarding_experience_level")
  onboardingInvestmentFocus   String?                      @map("onboarding_investment_focus")
  trialEndsAt                 DateTime?                    @map("trial_ends_at")
  trialStartedAt              DateTime?                    @map("trial_started_at")
  reportPreferences           Json?                        @map("report_preferences")
  accounts                    Account[]
  sessions                    Session[]
  aiReportFeedbacks           AIReportFeedback[]
  customReports               AIReport[]                   @relation("CustomReports")
  backtestConfigs             BacktestConfig[]
  debts                       Debt[]
  featureUsage                FeatureUsage[]
  notificationModalViews      NotificationModalView[]
  notifications               Notification[]
  portfolioConfigs            PortfolioConfig[]            @relation("UserPortfolioConfigs")
  portfolios                  Portfolio[]
  quizResponses               QuizResponse[]
  radarConfig                 RadarConfig?
  rankingHistory              RankingHistory[]
  assignedTickets             SupportTicket[]              @relation("AssignedTickets")
  supportTickets              SupportTicket[]
  ticketMessages              TicketMessage[]
  userAssetMonitors           UserAssetMonitor[]
  assetSubscriptions          UserAssetSubscription[]
  userEvents                  UserEvent[]
  notificationPreferences     UserNotificationPreferences?
  userSecurity                UserSecurity?

  @@map("users")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model UserSecurity {
  id                   String    @id @default(cuid())
  userId               String    @unique @map("user_id")
  registrationIp       String?   @map("registration_ip")
  lastLoginIp          String?   @map("last_login_ip")
  isSuspicious         Boolean   @default(false) @map("is_suspicious")
  suspiciousReason     String?   @map("suspicious_reason")
  suspiciousFlaggedAt  DateTime? @map("suspicious_flagged_at")
  suspiciousReviewedAt DateTime? @map("suspicious_reviewed_at")
  suspiciousReviewedBy String?   @map("suspicious_reviewed_by")
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @updatedAt @map("updated_at")
  user                 User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([registrationIp])
  @@index([isSuspicious])
  @@index([isSuspicious, suspiciousReviewedAt])
  @@index([userId])
  @@map("user_security")
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expires   DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")

  @@index([email])
  @@index([token])
  @@map("password_reset_tokens")
}

model Company {
  id                            Int                      @id @default(autoincrement())
  ticker                        String                   @unique
  name                          String
  sector                        String?
  industry                      String?
  cnpj                          String?
  description                   String?
  website                       String?
  address                       String?
  city                          String?
  state                         String?
  country                       String?
  fullTimeEmployees             Int?
  logoUrl                       String?
  updatedAt                     DateTime?                @updatedAt
  address2                      String?
  address3                      String?
  fax                           String?
  industryDisp                  String?
  industryKey                   String?
  phone                         String?
  sectorDisp                    String?
  sectorKey                     String?
  zip                           String?
  lastCheckedAt                 DateTime?                @map("last_checked_at")
  youtubeLastCheckedAt          DateTime?                @map("youtube_last_checked_at")
  assetType                     AssetType                @default(STOCK) @map("asset_type")
  dataUltimoDividendo           DateTime?                @map("data_ultimo_dividendo") @db.Date
  ultimoDividendo               Decimal?                 @map("ultimo_dividendo") @db.Decimal(15, 6)
  yahooLastUpdatedAt            DateTime?                @map("yahoo_last_updated_at")
  yahooLastBdrUpdatedAt         DateTime?                @map("yahoo_last_bdr_updated_at")
  dividendRadarLastDividendDate DateTime?                @map("dividend_radar_last_dividend_date") @db.Date
  dividendRadarLastProcessedAt  DateTime?                @map("dividend_radar_last_processed_at")
  dividendRadarProjections      Json?                    @map("dividend_radar_projections")
  priceVariationLastCheckedAt   DateTime?                @map("price_variation_last_checked_at")
  aiReports                     AIReport[]
  aiReportsQueue                AIReportsQueue[]
  snapshots                     AssetSnapshot[]
  technicalAnalyses             AssetTechnicalAnalysis[]
  balanceSheets                 BalanceSheet[]
  cashflowStatements            CashflowStatement[]
  flags                         CompanyFlag[]
  dailyQuotes                   DailyQuote[]
  dividendHistory               DividendHistory[]
  etfData                       EtfData?
  fiiData                       FiiData?
  financialData                 FinancialData[]
  historicalPrices              HistoricalPrice[]
  incomeStatements              IncomeStatement[]
  keyStatistics                 KeyStatistics[]
  priceOscillations             PriceOscillations[]
  quarterlyFinancials           QuarterlyFinancials[]
  userAssetMonitors             UserAssetMonitor[]
  userSubscriptions             UserAssetSubscription[]
  valueAddedStatements          ValueAddedStatement[]
  youtubeAnalyses               YouTubeAnalysis[]

  @@index([sector])
  @@index([industry])
  @@index([sector, industry])
  @@index([assetType])
  @@index([lastCheckedAt])
  @@index([youtubeLastCheckedAt])
  @@index([yahooLastUpdatedAt])
  @@index([priceVariationLastCheckedAt])
  @@index([dataUltimoDividendo])
  @@map("companies")
}

model FinancialData {
  id                         Int       @id @default(autoincrement())
  companyId                  Int       @map("company_id")
  year                       Int
  pl                         Decimal?  @db.Decimal(15, 6)
  forwardPE                  Decimal?  @map("forward_pe") @db.Decimal(15, 6)
  earningsYield              Decimal?  @map("earnings_yield") @db.Decimal(15, 6)
  pvp                        Decimal?  @db.Decimal(15, 6)
  dy                         Decimal?  @db.Decimal(15, 6)
  evEbitda                   Decimal?  @map("ev_ebitda") @db.Decimal(15, 6)
  evEbit                     Decimal?  @map("ev_ebit") @db.Decimal(15, 6)
  evRevenue                  Decimal?  @map("ev_revenue") @db.Decimal(15, 6)
  psr                        Decimal?  @db.Decimal(15, 6)
  pAtivos                    Decimal?  @map("p_ativos") @db.Decimal(15, 6)
  pCapGiro                   Decimal?  @map("p_cap_giro") @db.Decimal(15, 6)
  pEbit                      Decimal?  @map("p_ebit") @db.Decimal(15, 6)
  lpa                        Decimal?  @db.Decimal(15, 6)
  trailingEps                Decimal?  @map("trailing_eps") @db.Decimal(15, 6)
  vpa                        Decimal?  @db.Decimal(15, 6)
  marketCap                  Decimal?  @map("market_cap") @db.Decimal(20, 2)
  enterpriseValue            Decimal?  @map("enterprise_value") @db.Decimal(20, 2)
  sharesOutstanding          Decimal?  @map("shares_outstanding") @db.Decimal(20, 0)
  totalAssets                Decimal?  @map("total_assets") @db.Decimal(20, 2)
  dividaLiquidaPl            Decimal?  @map("divida_liquida_pl") @db.Decimal(15, 6)
  dividaLiquidaEbitda        Decimal?  @map("divida_liquida_ebitda") @db.Decimal(15, 6)
  liquidezCorrente           Decimal?  @map("liquidez_corrente") @db.Decimal(15, 6)
  liquidezRapida             Decimal?  @map("liquidez_rapida") @db.Decimal(15, 6)
  passivoAtivos              Decimal?  @map("passivo_ativos") @db.Decimal(15, 6)
  debtToEquity               Decimal?  @map("debt_to_equity") @db.Decimal(15, 6)
  roe                        Decimal?  @db.Decimal(15, 6)
  roic                       Decimal?  @db.Decimal(15, 6)
  roa                        Decimal?  @db.Decimal(15, 6)
  margemBruta                Decimal?  @map("margem_bruta") @db.Decimal(15, 6)
  margemEbitda               Decimal?  @map("margem_ebitda") @db.Decimal(15, 6)
  margemLiquida              Decimal?  @map("margem_liquida") @db.Decimal(15, 6)
  giroAtivos                 Decimal?  @map("giro_ativos") @db.Decimal(15, 6)
  cagrLucros5a               Decimal?  @map("cagr_lucros_5a") @db.Decimal(15, 6)
  crescimentoLucros          Decimal?  @map("crescimento_lucros") @db.Decimal(15, 6)
  crescimentoReceitas        Decimal?  @map("crescimento_receitas") @db.Decimal(15, 6)
  dividendYield12m           Decimal?  @map("dividend_yield_12m") @db.Decimal(15, 6)
  ultimoDividendo            Decimal?  @map("ultimo_dividendo") @db.Decimal(15, 6)
  dataUltimoDividendo        DateTime? @map("data_ultimo_dividendo") @db.Date
  payout                     Decimal?  @db.Decimal(15, 6)
  variacao52Semanas          Decimal?  @map("variacao_52_semanas") @db.Decimal(15, 6)
  retornoAnoAtual            Decimal?  @map("retorno_ano_atual") @db.Decimal(15, 6)
  ebitda                     Decimal?  @db.Decimal(20, 2)
  receitaTotal               Decimal?  @map("receita_total") @db.Decimal(20, 2)
  lucroLiquido               Decimal?  @map("lucro_liquido") @db.Decimal(20, 2)
  fluxoCaixaOperacional      Decimal?  @map("fluxo_caixa_operacional") @db.Decimal(20, 2)
  fluxoCaixaInvestimento     Decimal?  @map("fluxo_caixa_investimento") @db.Decimal(20, 2)
  fluxoCaixaFinanciamento    Decimal?  @map("fluxo_caixa_financiamento") @db.Decimal(20, 2)
  fluxoCaixaLivre            Decimal?  @map("fluxo_caixa_livre") @db.Decimal(20, 2)
  totalCaixa                 Decimal?  @map("total_caixa") @db.Decimal(20, 2)
  totalDivida                Decimal?  @map("total_divida") @db.Decimal(20, 2)
  receitaPorAcao             Decimal?  @map("receita_por_acao") @db.Decimal(15, 6)
  caixaPorAcao               Decimal?  @map("caixa_por_acao") @db.Decimal(15, 6)
  ativoCirculante            Decimal?  @map("ativo_circulante") @db.Decimal(20, 2)
  ativoTotal                 Decimal?  @map("ativo_total") @db.Decimal(20, 2)
  passivoCirculante          Decimal?  @map("passivo_circulante") @db.Decimal(20, 2)
  passivoTotal               Decimal?  @map("passivo_total") @db.Decimal(20, 2)
  patrimonioLiquido          Decimal?  @map("patrimonio_liquido") @db.Decimal(20, 2)
  caixa                      Decimal?  @db.Decimal(20, 2)
  estoques                   Decimal?  @db.Decimal(20, 2)
  contasReceber              Decimal?  @map("contas_receber") @db.Decimal(20, 2)
  imobilizado                Decimal?  @db.Decimal(20, 2)
  intangivel                 Decimal?  @db.Decimal(20, 2)
  dividaCirculante           Decimal?  @map("divida_circulante") @db.Decimal(20, 2)
  dividaLongoPrazo           Decimal?  @map("divida_longo_prazo") @db.Decimal(20, 2)
  dividendoMaisRecente       Decimal?  @map("dividendo_mais_recente") @db.Decimal(15, 6)
  dataDividendoMaisRecente   DateTime? @map("data_dividendo_mais_recente") @db.Date
  historicoUltimosDividendos String?   @map("historico_ultimos_dividendos")
  updatedAt                  DateTime? @updatedAt
  dataSource                 String?   @default("brapi") @map("data_source")
  cagrReceitas5a             Decimal?  @map("cagr_receitas_5a") @db.Decimal(15, 6)
  company                    Company   @relation(fields: [companyId], references: [id])

  @@unique([companyId, year])
  @@index([companyId, year])
  @@index([year])
  @@map("financial_data")
}

model DailyQuote {
  id        Int      @id @default(autoincrement())
  companyId Int      @map("company_id")
  date      DateTime @db.Date
  price     Decimal  @db.Decimal(10, 4)
  company   Company  @relation(fields: [companyId], references: [id])

  @@unique([companyId, date])
  @@index([companyId, date])
  @@index([date])
  @@map("daily_quotes")
}

model HistoricalPrice {
  id            Int      @id @default(autoincrement())
  companyId     Int      @map("company_id")
  date          DateTime @db.Date
  open          Decimal  @db.Decimal(10, 4)
  high          Decimal  @db.Decimal(10, 4)
  low           Decimal  @db.Decimal(10, 4)
  close         Decimal  @db.Decimal(10, 4)
  volume        BigInt
  adjustedClose Decimal  @map("adjusted_close") @db.Decimal(10, 4)
  interval      String   @default("1mo")
  updatedAt     DateTime @updatedAt @map("updated_at")
  company       Company  @relation(fields: [companyId], references: [id])

  @@unique([companyId, date, interval])
  @@index([companyId, interval, date])
  @@index([date])
  @@index([interval, date])
  @@index([companyId, date])
  @@map("historical_prices")
}

model DividendHistory {
  id          Int       @id @default(autoincrement())
  companyId   Int       @map("company_id")
  exDate      DateTime  @map("ex_date") @db.Date
  paymentDate DateTime? @map("payment_date") @db.Date
  amount      Decimal   @db.Decimal(15, 6)
  type        String?
  currency    String?   @default("BRL")
  source      String    @default("yahoo")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  company     Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, exDate, amount])
  @@index([companyId, exDate])
  @@index([exDate])
  @@index([companyId, paymentDate])
  @@map("dividend_history")
}

model Portfolio {
  id        String           @id @default(cuid())
  userId    String           @map("user_id")
  name      String
  createdAt DateTime         @default(now()) @map("created_at")
  assets    PortfolioAsset[]
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("portfolios")
}

model PortfolioAsset {
  id              String    @id @default(cuid())
  portfolioId     String    @map("portfolio_id")
  ticker          String
  initialQuantity Decimal   @map("initial_quantity") @db.Decimal(10, 4)
  initialPrice    Decimal   @map("initial_price") @db.Decimal(10, 4)
  portfolio       Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@map("portfolio_assets")
}

model PortfolioConfig {
  id                         String                 @id @default(cuid())
  userId                     String                 @map("user_id")
  name                       String
  description                String?
  startDate                  DateTime               @map("start_date") @db.Date
  monthlyContribution        Decimal                @map("monthly_contribution") @db.Decimal(12, 2)
  rebalanceFrequency         String                 @default("monthly")
  lastTransactionDate        DateTime?              @map("last_transaction_date") @db.Date
  isActive                   Boolean                @default(true) @map("is_active")
  createdAt                  DateTime               @default(now()) @map("created_at")
  updatedAt                  DateTime               @updatedAt @map("updated_at")
  sourceBacktestId           String?                @map("source_backtest_id")
  trackingStarted            Boolean                @default(false) @map("tracking_started")
  lastSuggestionsGeneratedAt DateTime?              @map("last_suggestions_generated_at")
  assets                     PortfolioConfigAsset[]
  user                       User                   @relation("UserPortfolioConfigs", fields: [userId], references: [id], onDelete: Cascade)
  metrics                    PortfolioMetrics?
  transactions               PortfolioTransaction[]

  @@index([userId, createdAt])
  @@index([userId, isActive])
  @@map("portfolio_configs")
}

model PortfolioConfigAsset {
  id               String          @id @default(cuid())
  portfolioId      String          @map("portfolio_id")
  ticker           String
  targetAllocation Decimal         @map("target_allocation") @db.Decimal(5, 4)
  addedAt          DateTime        @default(now()) @map("added_at")
  removedAt        DateTime?       @map("removed_at") @db.Date
  isActive         Boolean         @default(true) @map("is_active")
  portfolio        PortfolioConfig @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([portfolioId, isActive])
  @@index([portfolioId, ticker])
  @@map("portfolio_config_assets")
}

model PortfolioTransaction {
  id                  String            @id @default(cuid())
  portfolioId         String            @map("portfolio_id")
  date                DateTime          @db.Date
  type                TransactionType
  status              TransactionStatus @default(PENDING)
  ticker              String?
  amount              Decimal           @db.Decimal(12, 2)
  price               Decimal?          @db.Decimal(10, 4)
  quantity            Decimal?          @db.Decimal(15, 6)
  cashBalanceBefore   Decimal           @map("cash_balance_before") @db.Decimal(12, 2)
  cashBalanceAfter    Decimal           @map("cash_balance_after") @db.Decimal(12, 2)
  portfolioValueAfter Decimal?          @map("portfolio_value_after") @db.Decimal(15, 2)
  notes               String?
  rejectionReason     String?           @map("rejection_reason")
  createdAt           DateTime          @default(now()) @map("created_at")
  confirmedAt         DateTime?         @map("confirmed_at")
  rejectedAt          DateTime?         @map("rejected_at")
  revertedAt          DateTime?         @map("reverted_at")
  isAutoSuggested     Boolean           @default(false) @map("is_auto_suggested")
  dividendPaymentDate DateTime?         @map("dividend_payment_date") @db.Date
  dividendSourceId    String?           @map("dividend_source_id")
  portfolio           PortfolioConfig   @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([portfolioId, date])
  @@index([portfolioId, status])
  @@index([portfolioId, type])
  @@index([date])
  @@index([ticker, dividendPaymentDate])
  @@map("portfolio_transactions")
}

model PortfolioMetrics {
  id                 String          @id @default(cuid())
  portfolioId        String          @unique @map("portfolio_id")
  currentValue       Decimal         @map("current_value") @db.Decimal(15, 2)
  cashBalance        Decimal         @map("cash_balance") @db.Decimal(12, 2)
  totalInvested      Decimal         @map("total_invested") @db.Decimal(15, 2)
  totalWithdrawn     Decimal         @default(0) @map("total_withdrawn") @db.Decimal(15, 2)
  totalDividends     Decimal         @default(0) @map("total_dividends") @db.Decimal(12, 2)
  totalReturn        Decimal         @map("total_return") @db.Decimal(10, 4)
  annualizedReturn   Decimal?        @map("annualized_return") @db.Decimal(10, 4)
  volatility         Decimal?        @db.Decimal(10, 4)
  sharpeRatio        Decimal?        @map("sharpe_ratio") @db.Decimal(10, 4)
  maxDrawdown        Decimal?        @map("max_drawdown") @db.Decimal(10, 4)
  assetHoldings      Json            @map("asset_holdings")
  monthlyReturns     Json?           @map("monthly_returns")
  evolutionData      Json?           @map("evolution_data")
  sectorAllocation   Json?           @map("sector_allocation")
  industryAllocation Json?           @map("industry_allocation")
  lastCalculatedAt   DateTime        @default(now()) @map("last_calculated_at")
  portfolio          PortfolioConfig @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([lastCalculatedAt])
  @@map("portfolio_metrics")
}

model RankingHistory {
  id          String   @id @default(cuid())
  userId      String   @map("user_id")
  model       String
  params      Json
  results     Json?
  resultCount Int      @default(0) @map("result_count")
  createdAt   DateTime @default(now()) @map("created_at")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("ranking_history")
}

model TickerProcessingStatus {
  id                Int          @id @default(autoincrement())
  ticker            String       @unique
  processType       String       @default("ward_data_fetch") @map("process_type")
  status            TickerStatus @default(PENDING)
  hasBasicData      Boolean      @default(false) @map("has_basic_data")
  hasHistoricalData Boolean      @default(false) @map("has_historical_data")
  hasTTMData        Boolean      @default(false) @map("has_ttm_data")
  hasBrapiProData   Boolean      @default(false) @map("has_brapi_pro_data")
  lastProcessedAt   DateTime?    @map("last_processed_at")
  lastSuccessAt     DateTime?    @map("last_success_at")
  lastError         String?      @map("last_error")
  errorCount        Int          @default(0) @map("error_count")
  priority          Int          @default(0)
  metadata          Json?
  createdAt         DateTime     @default(now()) @map("created_at")
  updatedAt         DateTime     @updatedAt @map("updated_at")

  @@index([processType, status])
  @@index([lastProcessedAt])
  @@index([priority, status])
  @@map("ticker_processing_status")
}

model BalanceSheet {
  id                                                    Int          @id @default(autoincrement())
  companyId                                             Int          @map("company_id")
  period                                                ReportPeriod @default(YEARLY)
  endDate                                               DateTime     @map("end_date") @db.Date
  cash                                                  Decimal?     @db.Decimal(20, 2)
  shortTermInvestments                                  Decimal?     @map("short_term_investments") @db.Decimal(20, 2)
  totalCurrentAssets                                    Decimal?     @map("total_current_assets") @db.Decimal(20, 2)
  longTermInvestments                                   Decimal?     @map("long_term_investments") @db.Decimal(20, 2)
  otherAssets                                           Decimal?     @map("other_assets") @db.Decimal(20, 2)
  totalAssets                                           Decimal?     @map("total_assets") @db.Decimal(20, 2)
  totalCurrentLiabilities                               Decimal?     @map("total_current_liabilities") @db.Decimal(20, 2)
  totalLiab                                             Decimal?     @map("total_liab") @db.Decimal(20, 2)
  commonStock                                           Decimal?     @map("common_stock") @db.Decimal(20, 2)
  treasuryStock                                         Decimal?     @map("treasury_stock") @db.Decimal(20, 2)
  totalStockholderEquity                                Decimal?     @map("total_stockholder_equity") @db.Decimal(20, 2)
  netTangibleAssets                                     Decimal?     @map("net_tangible_assets") @db.Decimal(20, 2)
  goodWill                                              Decimal?     @map("good_will") @db.Decimal(20, 2)
  financialAssets                                       Decimal?     @map("financial_assets") @db.Decimal(20, 2)
  centralBankCompulsoryDeposit                          Decimal?     @map("central_bank_compulsory_deposit") @db.Decimal(20, 2)
  financialAssetsMeasuredAtFairValueThroughProfitOrLoss Decimal?     @map("financial_assets_measured_at_fair_value_through_profit_or_loss") @db.Decimal(20, 2)
  longTermAssets                                        Decimal?     @map("long_term_assets") @db.Decimal(20, 2)
  creditsFromOperations                                 Decimal?     @map("credits_from_operations") @db.Decimal(20, 2)
  complementaryPension                                  Decimal?     @map("complementary_pension") @db.Decimal(20, 2)
  deferredSellingExpenses                               Decimal?     @map("deferred_selling_expenses") @db.Decimal(20, 2)
  nonCurrentAssets                                      Decimal?     @map("non_current_assets") @db.Decimal(20, 2)
  deferredTaxes                                         Decimal?     @map("deferred_taxes") @db.Decimal(20, 2)
  financialLiabilitiesMeasuredAtFairValueThroughIncome  Decimal?     @map("financial_liabilities_measured_at_fair_value_through_income") @db.Decimal(20, 2)
  financialLiabilitiesAtAmortizedCost                   Decimal?     @map("financial_liabilities_at_amortized_cost") @db.Decimal(20, 2)
  provisions                                            Decimal?     @db.Decimal(20, 2)
  shareholdersEquity                                    Decimal?     @map("shareholders_equity") @db.Decimal(20, 2)
  realizedShareCapital                                  Decimal?     @map("realized_share_capital") @db.Decimal(20, 2)
  profitReserves                                        Decimal?     @map("profit_reserves") @db.Decimal(20, 2)
  accumulatedProfitsOrLosses                            Decimal?     @map("accumulated_profits_or_losses") @db.Decimal(20, 2)
  equityValuationAdjustments                            Decimal?     @map("equity_valuation_adjustments") @db.Decimal(20, 2)
  currentLiabilities                                    Decimal?     @map("current_liabilities") @db.Decimal(20, 2)
  nonCurrentLiabilities                                 Decimal?     @map("non_current_liabilities") @db.Decimal(20, 2)
  thirdPartyDeposits                                    Decimal?     @map("third_party_deposits") @db.Decimal(20, 2)
  otherDebits                                           Decimal?     @map("other_debits") @db.Decimal(20, 2)
  updatedAt                                             DateTime?    @updatedAt
  company                                               Company      @relation(fields: [companyId], references: [id])

  @@unique([companyId, endDate, period])
  @@index([companyId, period, endDate])
  @@index([endDate])
  @@map("balance_sheets")
}

model IncomeStatement {
  id                                                  Int          @id @default(autoincrement())
  companyId                                           Int          @map("company_id")
  period                                              ReportPeriod @default(YEARLY)
  endDate                                             DateTime     @map("end_date") @db.Date
  totalRevenue                                        Decimal?     @map("total_revenue") @db.Decimal(20, 2)
  costOfRevenue                                       Decimal?     @map("cost_of_revenue") @db.Decimal(20, 2)
  grossProfit                                         Decimal?     @map("gross_profit") @db.Decimal(20, 2)
  researchDevelopment                                 Decimal?     @map("research_development") @db.Decimal(20, 2)
  sellingGeneralAdministrative                        Decimal?     @map("selling_general_administrative") @db.Decimal(20, 2)
  nonRecurring                                        Decimal?     @map("non_recurring") @db.Decimal(20, 2)
  otherOperatingExpenses                              Decimal?     @map("other_operating_expenses") @db.Decimal(20, 2)
  totalOperatingExpenses                              Decimal?     @map("total_operating_expenses") @db.Decimal(20, 2)
  operatingIncome                                     Decimal?     @map("operating_income") @db.Decimal(20, 2)
  totalOtherIncomeExpenseNet                          Decimal?     @map("total_other_income_expense_net") @db.Decimal(20, 2)
  ebit                                                Decimal?     @db.Decimal(20, 2)
  interestExpense                                     Decimal?     @map("interest_expense") @db.Decimal(20, 2)
  incomeBeforeTax                                     Decimal?     @map("income_before_tax") @db.Decimal(20, 2)
  incomeTaxExpense                                    Decimal?     @map("income_tax_expense") @db.Decimal(20, 2)
  minorityInterest                                    Decimal?     @map("minority_interest") @db.Decimal(20, 2)
  netIncomeFromContinuingOps                          Decimal?     @map("net_income_from_continuing_ops") @db.Decimal(20, 2)
  discontinuedOperations                              Decimal?     @map("discontinued_operations") @db.Decimal(20, 2)
  extraordinaryItems                                  Decimal?     @map("extraordinary_items") @db.Decimal(20, 2)
  effectOfAccountingCharges                           Decimal?     @map("effect_of_accounting_charges") @db.Decimal(20, 2)
  otherItems                                          Decimal?     @map("other_items") @db.Decimal(20, 2)
  netIncome                                           Decimal?     @map("net_income") @db.Decimal(20, 2)
  netIncomeApplicableToCommonShares                   Decimal?     @map("net_income_applicable_to_common_shares") @db.Decimal(20, 2)
  salesExpenses                                       Decimal?     @map("sales_expenses") @db.Decimal(20, 2)
  lossesDueToNonRecoverabilityOfAssets                Decimal?     @map("losses_due_to_non_recoverability_of_assets") @db.Decimal(20, 2)
  otherOperatingIncome                                Decimal?     @map("other_operating_income") @db.Decimal(20, 2)
  equityIncomeResult                                  Decimal?     @map("equity_income_result") @db.Decimal(20, 2)
  financialResult                                     Decimal?     @map("financial_result") @db.Decimal(20, 2)
  financialIncome                                     Decimal?     @map("financial_income") @db.Decimal(20, 2)
  financialExpenses                                   Decimal?     @map("financial_expenses") @db.Decimal(20, 2)
  currentTaxes                                        Decimal?     @map("current_taxes") @db.Decimal(20, 2)
  deferredTaxes                                       Decimal?     @map("deferred_taxes") @db.Decimal(20, 2)
  incomeBeforeStatutoryParticipationsAndContributions Decimal?     @map("income_before_statutory_participations_and_contributions") @db.Decimal(20, 2)
  basicEarningsPerCommonShare                         Decimal?     @map("basic_earnings_per_common_share") @db.Decimal(15, 6)
  dilutedEarningsPerCommonShare                       Decimal?     @map("diluted_earnings_per_common_share") @db.Decimal(15, 6)
  basicEarningsPerPreferredShare                      Decimal?     @map("basic_earnings_per_preferred_share") @db.Decimal(15, 6)
  dilutedEarningsPerPreferredShare                    Decimal?     @map("diluted_earnings_per_preferred_share") @db.Decimal(15, 6)
  profitSharingAndStatutoryContributions              Decimal?     @map("profit_sharing_and_statutory_contributions") @db.Decimal(20, 2)
  claimsAndOperationsCosts                            Decimal?     @map("claims_and_operations_costs") @db.Decimal(20, 2)
  administrativeCosts                                 Decimal?     @map("administrative_costs") @db.Decimal(20, 2)
  otherOperatingIncomeAndExpenses                     Decimal?     @map("other_operating_income_and_expenses") @db.Decimal(20, 2)
  earningsPerShare                                    Decimal?     @map("earnings_per_share") @db.Decimal(15, 6)
  basicEarningsPerShare                               Decimal?     @map("basic_earnings_per_share") @db.Decimal(15, 6)
  dilutedEarningsPerShare                             Decimal?     @map("diluted_earnings_per_share") @db.Decimal(15, 6)
  insuranceOperations                                 Decimal?     @map("insurance_operations") @db.Decimal(20, 2)
  reinsuranceOperations                               Decimal?     @map("reinsurance_operations") @db.Decimal(20, 2)
  complementaryPensionOperations                      Decimal?     @map("complementary_pension_operations") @db.Decimal(20, 2)
  capitalizationOperations                            Decimal?     @map("capitalization_operations") @db.Decimal(20, 2)
  updatedAt                                           DateTime?    @updatedAt
  company                                             Company      @relation(fields: [companyId], references: [id])

  @@unique([companyId, endDate, period])
  @@index([companyId, period, endDate])
  @@index([endDate])
  @@map("income_statements")
}

model CashflowStatement {
  id                            Int          @id @default(autoincrement())
  companyId                     Int          @map("company_id")
  period                        ReportPeriod @default(YEARLY)
  endDate                       DateTime     @map("end_date") @db.Date
  operatingCashFlow             Decimal?     @map("operating_cash_flow") @db.Decimal(20, 2)
  incomeFromOperations          Decimal?     @map("income_from_operations") @db.Decimal(20, 2)
  netIncomeBeforeTaxes          Decimal?     @map("net_income_before_taxes") @db.Decimal(20, 2)
  adjustmentsToProfitOrLoss     Decimal?     @map("adjustments_to_profit_or_loss") @db.Decimal(20, 2)
  changesInAssetsAndLiabilities Decimal?     @map("changes_in_assets_and_liabilities") @db.Decimal(20, 2)
  otherOperatingActivities      Decimal?     @map("other_operating_activities") @db.Decimal(20, 2)
  investmentCashFlow            Decimal?     @map("investment_cash_flow") @db.Decimal(20, 2)
  financingCashFlow             Decimal?     @map("financing_cash_flow") @db.Decimal(20, 2)
  increaseOrDecreaseInCash      Decimal?     @map("increase_or_decrease_in_cash") @db.Decimal(20, 2)
  initialCashBalance            Decimal?     @map("initial_cash_balance") @db.Decimal(20, 2)
  finalCashBalance              Decimal?     @map("final_cash_balance") @db.Decimal(20, 2)
  cashGeneratedInOperations     Decimal?     @map("cash_generated_in_operations") @db.Decimal(20, 2)
  updatedAt                     DateTime?    @updatedAt
  company                       Company      @relation(fields: [companyId], references: [id])

  @@unique([companyId, endDate, period])
  @@index([companyId, period, endDate])
  @@index([endDate])
  @@map("cashflow_statements")
}

model KeyStatistics {
  id                      Int          @id @default(autoincrement())
  companyId               Int          @map("company_id")
  period                  ReportPeriod @default(YEARLY)
  endDate                 DateTime     @map("end_date") @db.Date
  enterpriseValue         Decimal?     @map("enterprise_value") @db.Decimal(20, 2)
  forwardPE               Decimal?     @map("forward_pe") @db.Decimal(15, 6)
  profitMargins           Decimal?     @map("profit_margins") @db.Decimal(15, 6)
  sharesOutstanding       Decimal?     @map("shares_outstanding") @db.Decimal(20, 0)
  bookValue               Decimal?     @map("book_value") @db.Decimal(15, 6)
  priceToBook             Decimal?     @map("price_to_book") @db.Decimal(15, 6)
  mostRecentQuarter       DateTime?    @map("most_recent_quarter") @db.Date
  earningsQuarterlyGrowth Decimal?     @map("earnings_quarterly_growth") @db.Decimal(15, 6)
  earningsAnnualGrowth    Decimal?     @map("earnings_annual_growth") @db.Decimal(15, 6)
  trailingEps             Decimal?     @map("trailing_eps") @db.Decimal(15, 6)
  enterpriseToRevenue     Decimal?     @map("enterprise_to_revenue") @db.Decimal(15, 6)
  enterpriseToEbitda      Decimal?     @map("enterprise_to_ebitda") @db.Decimal(15, 6)
  fiftyTwoWeekChange      Decimal?     @map("fifty_two_week_change") @db.Decimal(15, 6)
  ytdReturn               Decimal?     @map("ytd_return") @db.Decimal(15, 6)
  lastDividendValue       Decimal?     @map("last_dividend_value") @db.Decimal(15, 6)
  lastDividendDate        DateTime?    @map("last_dividend_date") @db.Date
  dividendYield           Decimal?     @map("dividend_yield") @db.Decimal(15, 6)
  totalAssets             Decimal?     @map("total_assets") @db.Decimal(20, 2)
  updatedAt               DateTime?    @updatedAt
  company                 Company      @relation(fields: [companyId], references: [id])

  @@unique([companyId, endDate, period])
  @@map("key_statistics")
}

model ValueAddedStatement {
  id                             Int          @id @default(autoincrement())
  companyId                      Int          @map("company_id")
  period                         ReportPeriod @default(YEARLY)
  endDate                        DateTime     @map("end_date") @db.Date
  revenue                        Decimal?     @db.Decimal(20, 2)
  financialIntermediationRevenue Decimal?     @map("financial_intermediation_revenue") @db.Decimal(20, 2)
  updatedAt                      DateTime?    @updatedAt
  company                        Company      @relation(fields: [companyId], references: [id])

  @@unique([companyId, endDate, period])
  @@map("value_added_statements")
}

model SupportTicket {
  id          String          @id @default(cuid())
  userId      String          @map("user_id")
  title       String
  description String
  status      TicketStatus    @default(OPEN)
  priority    TicketPriority  @default(MEDIUM)
  category    TicketCategory  @default(GENERAL)
  assignedTo  String?         @map("assigned_to")
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")
  closedAt    DateTime?       @map("closed_at")
  assignee    User?           @relation("AssignedTickets", fields: [assignedTo], references: [id])
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages    TicketMessage[]

  @@index([userId])
  @@index([status])
  @@index([assignedTo])
  @@index([createdAt])
  @@map("support_tickets")
}

model TicketMessage {
  id         String        @id @default(cuid())
  ticketId   String        @map("ticket_id")
  userId     String        @map("user_id")
  message    String
  isInternal Boolean       @default(false) @map("is_internal")
  createdAt  DateTime      @default(now()) @map("created_at")
  ticket     SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([userId])
  @@index([createdAt])
  @@map("ticket_messages")
}

model PriceOscillations {
  id                 Int       @id @default(autoincrement())
  companyId          Int       @map("company_id")
  extractionDate     DateTime  @map("extraction_date") @db.Date
  variationDay       Decimal?  @map("variation_day") @db.Decimal(15, 6)
  variationMonth     Decimal?  @map("variation_month") @db.Decimal(15, 6)
  variation30Days    Decimal?  @map("variation_30_days") @db.Decimal(15, 6)
  variation12Months  Decimal?  @map("variation_12_months") @db.Decimal(15, 6)
  variation2025      Decimal?  @map("variation_2025") @db.Decimal(15, 6)
  variation2024      Decimal?  @map("variation_2024") @db.Decimal(15, 6)
  variation2023      Decimal?  @map("variation_2023") @db.Decimal(15, 6)
  variation2022      Decimal?  @map("variation_2022") @db.Decimal(15, 6)
  variation2021      Decimal?  @map("variation_2021") @db.Decimal(15, 6)
  variation2020      Decimal?  @map("variation_2020") @db.Decimal(15, 6)
  min52Weeks         Decimal?  @map("min_52_weeks") @db.Decimal(10, 4)
  max52Weeks         Decimal?  @map("max_52_weeks") @db.Decimal(10, 4)
  tradedVolumePerDay Decimal?  @map("traded_volume_per_day") @db.Decimal(20, 2)
  updatedAt          DateTime? @updatedAt
  company            Company   @relation(fields: [companyId], references: [id])

  @@unique([companyId, extractionDate])
  @@index([companyId, extractionDate])
  @@map("price_oscillations")
}

model QuarterlyFinancials {
  id                    Int       @id @default(autoincrement())
  companyId             Int       @map("company_id")
  extractionDate        DateTime  @map("extraction_date") @db.Date
  quarterlyRevenue      Decimal?  @map("quarterly_revenue") @db.Decimal(20, 2)
  quarterlyEbit         Decimal?  @map("quarterly_ebit") @db.Decimal(20, 2)
  quarterlyNetIncome    Decimal?  @map("quarterly_net_income") @db.Decimal(20, 2)
  twelveMonthsRevenue   Decimal?  @map("twelve_months_revenue") @db.Decimal(20, 2)
  twelveMonthsEbit      Decimal?  @map("twelve_months_ebit") @db.Decimal(20, 2)
  twelveMonthsNetIncome Decimal?  @map("twelve_months_net_income") @db.Decimal(20, 2)
  updatedAt             DateTime? @updatedAt
  company               Company   @relation(fields: [companyId], references: [id])

  @@unique([companyId, extractionDate])
  @@index([companyId, extractionDate])
  @@map("quarterly_financials")
}

model AIReport {
  id                String             @id @default(cuid())
  companyId         Int                @map("company_id")
  content           String
  strategicAnalyses Json?
  metadata          Json?
  version           Int                @default(1)
  isActive          Boolean            @default(true) @map("is_active")
  likeCount         Int                @default(0) @map("like_count")
  dislikeCount      Int                @default(0) @map("dislike_count")
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  status            ReportStatus       @default(COMPLETED)
  changeDirection   String?            @map("change_direction")
  currentScore      Decimal?           @map("current_score") @db.Decimal(5, 2)
  previousScore     Decimal?           @map("previous_score") @db.Decimal(5, 2)
  type              AIReportType       @default(MONTHLY_OVERVIEW)
  snapshotId        String?            @map("snapshot_id")
  userId            String?            @map("user_id")
  windowDays        Int?               @map("window_days")
  conclusion        String?            @db.Text
  feedbacks         AIReportFeedback[]
  company           Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  snapshot          AssetSnapshot?     @relation("SnapshotReports", fields: [snapshotId], references: [id])
  user              User?              @relation("CustomReports", fields: [userId], references: [id])
  queueEntries      AIReportsQueue[]   @relation("QueueReports")
  flags             CompanyFlag[]      @relation("FlagReports")

  @@index([companyId, isActive])
  @@index([companyId, createdAt])
  @@index([companyId, status])
  @@index([companyId, type])
  @@index([companyId, type, windowDays])
  @@index([snapshotId])
  @@index([userId])
  @@index([createdAt])
  @@map("ai_reports")
}

model AIReportFeedback {
  id        String       @id @default(cuid())
  reportId  String       @map("report_id")
  userId    String       @map("user_id")
  type      FeedbackType
  comment   String?
  createdAt DateTime     @default(now()) @map("created_at")
  updatedAt DateTime     @updatedAt @map("updated_at")
  report    AIReport     @relation(fields: [reportId], references: [id], onDelete: Cascade)
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([reportId, userId])
  @@index([reportId])
  @@index([userId])
  @@map("ai_report_feedbacks")
}

model BacktestConfig {
  id                  String                @id @default(cuid())
  userId              String                @map("user_id")
  name                String
  description         String?
  startDate           DateTime              @map("start_date") @db.Date
  endDate             DateTime              @map("end_date") @db.Date
  monthlyContribution Decimal               @map("monthly_contribution") @db.Decimal(12, 2)
  rebalanceFrequency  String                @default("monthly")
  createdAt           DateTime              @default(now()) @map("created_at")
  updatedAt           DateTime              @updatedAt @map("updated_at")
  initialCapital      Decimal               @map("initial_capital") @db.Decimal(15, 2)
  assets              BacktestAsset[]
  user                User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  results             BacktestResult[]
  transactions        BacktestTransaction[]

  @@index([userId, createdAt])
  @@index([userId, updatedAt])
  @@map("backtest_configs")
}

model BacktestAsset {
  id                   String         @id @default(cuid())
  backtestId           String         @map("backtest_id")
  ticker               String
  targetAllocation     Decimal        @map("target_allocation") @db.Decimal(5, 4)
  averageDividendYield Decimal?       @map("average_dividend_yield") @db.Decimal(5, 4)
  backtest             BacktestConfig @relation(fields: [backtestId], references: [id], onDelete: Cascade)

  @@unique([backtestId, ticker])
  @@index([backtestId])
  @@index([ticker])
  @@map("backtest_assets")
}

model BacktestResult {
  id                     String         @id @default(cuid())
  backtestId             String         @map("backtest_id")
  totalReturn            Decimal        @map("total_return") @db.Decimal(10, 4)
  annualizedReturn       Decimal        @map("annualized_return") @db.Decimal(10, 4)
  volatility             Decimal        @db.Decimal(10, 4)
  sharpeRatio            Decimal?       @map("sharpe_ratio") @db.Decimal(10, 4)
  maxDrawdown            Decimal        @map("max_drawdown") @db.Decimal(10, 4)
  positiveMonths         Int            @map("positive_months")
  negativeMonths         Int            @map("negative_months")
  totalMonths            Int            @map("total_months")
  totalInvested          Decimal        @map("total_invested") @db.Decimal(15, 2)
  finalValue             Decimal        @map("final_value") @db.Decimal(15, 2)
  monthlyReturns         Json           @map("monthly_returns")
  assetPerformance       Json           @map("asset_performance")
  portfolioEvolution     Json           @map("portfolio_evolution")
  calculatedAt           DateTime       @default(now()) @map("calculated_at")
  totalDividendsReceived Decimal?       @map("total_dividends_received") @db.Decimal(15, 2)
  finalCashReserve       Decimal?       @map("final_cash_reserve") @db.Decimal(15, 2)
  backtest               BacktestConfig @relation(fields: [backtestId], references: [id], onDelete: Cascade)

  @@index([calculatedAt])
  @@index([totalReturn])
  @@index([annualizedReturn])
  @@map("backtest_results")
}

model BacktestTransaction {
  id                String         @id @default(cuid())
  backtestId        String         @map("backtest_id")
  month             Int
  date              DateTime       @db.Date
  ticker            String
  contribution      Decimal        @db.Decimal(12, 2)
  price             Decimal        @db.Decimal(10, 4)
  sharesAdded       Decimal        @db.Decimal(15, 6)
  totalShares       Decimal        @db.Decimal(15, 6)
  totalInvested     Decimal        @db.Decimal(15, 2)
  totalContribution Decimal        @map("total_contribution") @db.Decimal(12, 2)
  portfolioValue    Decimal        @map("portfolio_value") @db.Decimal(15, 2)
  cashReserved      Decimal?       @db.Decimal(12, 2)
  cashBalance       Decimal        @default(0) @map("cash_balance") @db.Decimal(12, 2)
  transactionType   String         @default("CONTRIBUTION")
  backtest          BacktestConfig @relation(fields: [backtestId], references: [id], onDelete: Cascade)

  @@index([backtestId, month])
  @@index([backtestId, ticker, month])
  @@index([backtestId, transactionType])
  @@index([backtestId, date])
  @@index([ticker, transactionType])
  @@map("backtest_transactions")
}

model AlfaWaitlist {
  id        String    @id @default(cuid())
  name      String
  email     String    @unique
  createdAt DateTime  @default(now()) @map("created_at")
  invitedAt DateTime? @map("invited_at")
  isInvited Boolean   @default(false) @map("is_invited")

  @@index([createdAt])
  @@index([isInvited])
  @@map("alfa_waitlist")
}

model UserAssetSubscription {
  id               String   @id @default(cuid())
  userId           String?  @map("user_id")
  companyId        Int      @map("company_id")
  createdAt        DateTime @default(now()) @map("created_at")
  email            String?
  unsubscribeToken String?
  company          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user             User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, companyId], map: "idx_user_company")
  @@index([email, companyId], map: "idx_email_company")
  @@index([userId])
  @@index([companyId])
  @@index([email])
  @@index([unsubscribeToken])
  @@map("user_asset_subscriptions")
}

model AssetSnapshot {
  id               String     @id @default(cuid())
  companyId        Int        @map("company_id")
  snapshotData     Json       @map("snapshot_data")
  overallScore     Decimal    @map("overall_score") @db.Decimal(5, 2)
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime   @updatedAt @map("updated_at")
  isLatest         Boolean    @default(true) @map("is_latest")
  scoreComposition Json?      @map("score_composition")
  penaltyInfo      Json?      @map("penalty_info")
  aiReports        AIReport[] @relation("SnapshotReports")
  company          Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, isLatest])
  @@index([companyId, createdAt])
  @@index([updatedAt])
  @@map("asset_snapshots")
}

model YouTubeAnalysis {
  id             String   @id @default(cuid())
  companyId      Int      @map("company_id")
  score          Decimal  @db.Decimal(5, 2)
  summary        String
  positivePoints Json?    @map("positive_points")
  negativePoints Json?    @map("negative_points")
  videoIds       Json     @map("video_ids")
  isActive       Boolean  @default(true) @map("is_active")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  company        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, isActive])
  @@index([companyId, createdAt])
  @@index([updatedAt])
  @@map("youtube_analyses")
}

model EtfData {
  id              Int       @id @default(autoincrement())
  companyId       Int       @unique @map("company_id")
  netAssets       Decimal?  @map("net_assets") @db.Decimal(20, 2)
  netExpenseRatio Decimal?  @map("net_expense_ratio") @db.Decimal(5, 4)
  dividendYield   Decimal?  @map("dividend_yield") @db.Decimal(15, 6)
  ytdReturn       Decimal?  @map("ytd_return") @db.Decimal(15, 6)
  category        String?
  totalAssets     Decimal?  @map("total_assets") @db.Decimal(20, 2)
  updatedAt       DateTime? @updatedAt
  company         Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("etf_data")
}

model FiiData {
  id                Int       @id @default(autoincrement())
  companyId         Int       @unique @map("company_id")
  netAssets         Decimal?  @map("net_assets") @db.Decimal(20, 2)
  dividendYield     Decimal?  @map("dividend_yield") @db.Decimal(15, 6)
  lastDividendValue Decimal?  @map("last_dividend_value") @db.Decimal(15, 6)
  lastDividendDate  DateTime? @map("last_dividend_date") @db.Date
  patrimonioLiquido Decimal?  @map("patrimonio_liquido") @db.Decimal(20, 2)
  valorPatrimonial  Decimal?  @map("valor_patrimonial") @db.Decimal(15, 6)
  updatedAt         DateTime? @updatedAt
  company           Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("fii_data")
}

model EmailQueue {
  id            String      @id @default(cuid())
  email         String
  emailType     EmailType   @map("email_type")
  recipientName String?     @map("recipient_name")
  emailData     Json        @map("email_data")
  status        EmailStatus @default(PENDING)
  attempts      Int         @default(0)
  lastAttemptAt DateTime?   @map("last_attempt_at")
  errorMessage  String?     @map("error_message")
  createdAt     DateTime    @default(now()) @map("created_at")
  sentAt        DateTime?   @map("sent_at")
  priority      Int         @default(0)
  metadata      Json?

  @@index([status, createdAt])
  @@index([emailType, status])
  @@index([createdAt])
  @@index([sentAt])
  @@map("email_queue")
}

model UserEvent {
  id        String    @id @default(cuid())
  userId    String?   @map("user_id")
  sessionId String    @map("session_id")
  eventType EventType @map("event_type")
  page      String
  element   String?
  metadata  Json?
  timestamp DateTime
  userAgent String?   @map("user_agent")
  ipHash    String?   @map("ip_hash")
  referrer  String?
  createdAt DateTime  @default(now()) @map("created_at")
  user      User?     @relation(fields: [userId], references: [id])

  @@index([userId, timestamp])
  @@index([sessionId, timestamp])
  @@index([eventType, timestamp])
  @@index([page, timestamp])
  @@index([timestamp])
  @@index([userId, eventType])
  @@map("user_events")
}

model WebhookEvent {
  id                String             @id @default(cuid())
  provider          WebhookProvider
  eventId           String?            @map("event_id")
  eventType         String             @map("event_type")
  status            WebhookEventStatus @default(PENDING)
  rawData           Json               @map("raw_data")
  processedData     Json?              @map("processed_data")
  userId            String?            @map("user_id")
  paymentId         String?            @map("payment_id")
  externalReference String?            @map("external_reference")
  errorMessage      String?            @map("error_message")
  retryCount        Int                @default(0) @map("retry_count")
  lastProcessedAt   DateTime?          @map("last_processed_at")
  receivedAt        DateTime           @default(now()) @map("received_at")
  processedAt       DateTime?          @map("processed_at")
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")

  @@index([provider, status])
  @@index([status, createdAt])
  @@index([eventId, provider])
  @@index([userId])
  @@index([paymentId])
  @@index([externalReference])
  @@index([createdAt])
  @@map("webhook_events")
}

model PlBolsaHistory {
  id                  String   @id @default(cuid())
  date                DateTime @db.Date
  pl                  Decimal  @db.Decimal(10, 4)
  averagePl           Decimal  @map("average_pl") @db.Decimal(10, 4)
  companyCount        Int      @map("company_count")
  sector              String?
  minScore            Int?     @map("min_score")
  excludeUnprofitable Boolean  @default(false) @map("exclude_unprofitable")
  calculatedAt        DateTime @default(now()) @map("calculated_at")

  @@unique([date, sector, minScore, excludeUnprofitable], name: "pl_bolsa_history_unique")
  @@index([date])
  @@index([calculatedAt])
  @@index([sector, date])
  @@map("pl_bolsa_history")
}

model Offer {
  id                    String    @id
  type                  OfferType
  price_in_cents        Int       @map("price_in_cents")
  stripe_price_id       String?   @map("stripe_price_id")
  is_active             Boolean   @default(true) @map("is_active")
  currency              String    @default("BRL")
  created_at            DateTime  @default(now()) @map("created_at")
  updated_at            DateTime  @updatedAt @map("updated_at")
  expires_at            DateTime? @map("expires_at")
  premium_duration_days Int?      @map("premium_duration_days")

  @@unique([type, is_active], name: "unique_active_offer_per_type")
  @@index([type])
  @@index([is_active])
  @@index([expires_at])
  @@map("offers")
}

model ExitIntentFeedback {
  id                       String   @id @default(cuid())
  reason                   String
  suggested_price_in_cents Int?     @map("suggested_price_in_cents")
  page                     String
  created_at               DateTime @default(now()) @map("created_at")

  @@index([reason])
  @@index([created_at])
  @@index([page])
  @@map("exit_intent_feedback")
}

model BlogPost {
  id               String         @id @default(cuid())
  slug             String         @unique
  title            String
  excerpt          String
  category         String
  readTime         String         @map("read_time")
  publishDate      DateTime?      @map("publish_date") @db.Date
  author           String         @default("Equipe Preo Justo AI")
  featured         Boolean        @default(false)
  seoTitle         String?        @map("seo_title")
  seoDescription   String?        @map("seo_description")
  image            String?
  imageAlt         String?        @map("image_alt")
  canonicalUrl     String?        @map("canonical_url")
  content          String
  status           BlogPostStatus @default(DRAFT)
  tags             Json           @default("[]")
  lastModified     DateTime?      @map("last_modified") @db.Date
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  generatedBy      String         @default("manual") @map("generated_by")
  generationPrompt String?        @map("generation_prompt")
  sourceTopics     Json?          @map("source_topics")

  @@index([status])
  @@index([status, publishDate])
  @@index([category])
  @@index([slug])
  @@index([featured])
  @@index([createdAt])
  @@index([publishDate])
  @@map("blog_posts")
}

model AssetTechnicalAnalysis {
  id                  String   @id @default(cuid())
  companyId           Int      @map("company_id")
  rsi                 Decimal? @db.Decimal(5, 2)
  stochasticK         Decimal? @map("stochastic_k") @db.Decimal(5, 2)
  stochasticD         Decimal? @map("stochastic_d") @db.Decimal(5, 2)
  macd                Decimal? @db.Decimal(10, 4)
  macdSignal          Decimal? @map("macd_signal") @db.Decimal(10, 4)
  macdHistogram       Decimal? @map("macd_histogram") @db.Decimal(10, 4)
  sma20               Decimal? @map("sma_20") @db.Decimal(10, 4)
  sma50               Decimal? @map("sma_50") @db.Decimal(10, 4)
  sma200              Decimal? @map("sma_200") @db.Decimal(10, 4)
  ema12               Decimal? @map("ema_12") @db.Decimal(10, 4)
  ema26               Decimal? @map("ema_26") @db.Decimal(10, 4)
  bbUpper             Decimal? @map("bb_upper") @db.Decimal(10, 4)
  bbMiddle            Decimal? @map("bb_middle") @db.Decimal(10, 4)
  bbLower             Decimal? @map("bb_lower") @db.Decimal(10, 4)
  bbWidth             Decimal? @map("bb_width") @db.Decimal(10, 4)
  fib236              Decimal? @map("fib_236") @db.Decimal(10, 4)
  fib382              Decimal? @map("fib_382") @db.Decimal(10, 4)
  fib500              Decimal? @map("fib_500") @db.Decimal(10, 4)
  fib618              Decimal? @map("fib_618") @db.Decimal(10, 4)
  fib786              Decimal? @map("fib_786") @db.Decimal(10, 4)
  tenkanSen           Decimal? @map("tenkan_sen") @db.Decimal(10, 4)
  kijunSen            Decimal? @map("kijun_sen") @db.Decimal(10, 4)
  senkouSpanA         Decimal? @map("senkou_span_a") @db.Decimal(10, 4)
  senkouSpanB         Decimal? @map("senkou_span_b") @db.Decimal(10, 4)
  chikouSpan          Decimal? @map("chikou_span") @db.Decimal(10, 4)
  supportLevels       Json?    @map("support_levels")
  resistanceLevels    Json?    @map("resistance_levels")
  psychologicalLevels Json?    @map("psychological_levels")
  aiMinPrice          Decimal? @map("ai_min_price") @db.Decimal(10, 4)
  aiMaxPrice          Decimal? @map("ai_max_price") @db.Decimal(10, 4)
  aiFairEntryPrice    Decimal? @map("ai_fair_entry_price") @db.Decimal(10, 4)
  aiAnalysis          String?  @map("ai_analysis")
  aiConfidence        Decimal? @map("ai_confidence") @db.Decimal(5, 2)
  calculatedAt        DateTime @default(now()) @map("calculated_at")
  expiresAt           DateTime @map("expires_at")
  isActive            Boolean  @default(true) @map("is_active")
  company             Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, calculatedAt])
  @@index([companyId, isActive])
  @@index([companyId, expiresAt])
  @@index([expiresAt])
  @@map("asset_technical_analysis")
}

model FeatureUsage {
  id         String   @id @default(cuid())
  userId     String   @map("user_id")
  feature    String
  resourceId String?  @map("resource_id")
  usedAt     DateTime @default(now()) @map("used_at")
  month      Int
  year       Int
  metadata   Json?
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, feature, resourceId, month, year], name: "feature_usage_unique")
  @@index([userId, feature, year, month])
  @@index([feature, year, month])
  @@map("feature_usage")
}

model RadarConfig {
  id        String   @id @default(cuid())
  userId    String   @unique @map("user_id")
  tickers   Json
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("radar_configs")
}

model Notification {
  id         String                @id @default(cuid())
  userId     String                @map("user_id")
  campaignId String?               @map("campaign_id")
  title      String
  message    String
  link       String?
  linkType   NotificationLinkType  @default(INTERNAL) @map("link_type")
  type       NotificationType
  isRead     Boolean               @default(false) @map("is_read")
  readAt     DateTime?             @map("read_at")
  metadata   Json?
  createdAt  DateTime              @default(now()) @map("created_at")
  campaign   NotificationCampaign? @relation(fields: [campaignId], references: [id])
  user       User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isRead, createdAt])
  @@index([userId, createdAt])
  @@index([campaignId])
  @@index([type])
  @@index([isRead])
  @@map("notifications")
}

model NotificationCampaign {
  id                 String                  @id @default(cuid())
  title              String
  message            String
  link               String?
  linkType           NotificationLinkType    @default(INTERNAL) @map("link_type")
  segmentType        NotificationSegmentType @map("segment_type")
  segmentConfig      Json                    @map("segment_config")
  showOnDashboard    Boolean                 @default(false) @map("show_on_dashboard")
  dashboardExpiresAt DateTime?               @map("dashboard_expires_at")
  createdBy          String                  @map("created_by")
  stats              Json?
  createdAt          DateTime                @default(now()) @map("created_at")
  ctaText            String?                 @map("cta_text")
  bannerTemplate     NotificationTemplate?   @map("banner_template")
  displayType        NotificationDisplayType @default(BANNER) @map("display_type")
  illustrationUrl    String?                 @map("illustration_url")
  modalTemplate      NotificationTemplate?   @map("modal_template")
  quizConfig         Json?                   @map("quiz_config")
  bannerColors       Json?                   @map("banner_colors")
  isActive           Boolean                 @default(true) @map("is_active")
  emailProvider      EmailProvider?          @default(RESEND) @map("email_provider")
  modalViews         NotificationModalView[]
  notifications      Notification[]
  quizResponses      QuizResponse[]

  @@index([createdAt])
  @@index([showOnDashboard, dashboardExpiresAt])
  @@index([displayType])
  @@index([isActive])
  @@map("notification_campaigns")
}

model UserNotificationPreferences {
  id                        String   @id @default(cuid())
  userId                    String   @unique @map("user_id")
  emailNotificationsEnabled Boolean  @default(true) @map("email_notifications_enabled")
  createdAt                 DateTime @default(now()) @map("created_at")
  updatedAt                 DateTime @updatedAt @map("updated_at")
  user                      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("user_notification_preferences")
}

model NotificationModalView {
  id          String               @id @default(cuid())
  userId      String               @map("user_id")
  campaignId  String               @map("campaign_id")
  viewedAt    DateTime             @default(now()) @map("viewed_at")
  dismissedAt DateTime?            @map("dismissed_at")
  campaign    NotificationCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  user        User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, campaignId])
  @@index([userId])
  @@index([campaignId])
  @@map("notification_modal_views")
}

model QuizResponse {
  id          String               @id @default(cuid())
  userId      String               @map("user_id")
  campaignId  String               @map("campaign_id")
  responses   Json
  completedAt DateTime             @default(now()) @map("completed_at")
  campaign    NotificationCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  user        User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, campaignId])
  @@index([userId])
  @@index([campaignId])
  @@map("quiz_responses")
}

model Debt {
  id                 String                @id @default(cuid())
  userId             String                @map("user_id")
  name               String
  balance            Decimal               @db.Decimal(15, 2)
  interestRateAnnual Decimal               @map("interest_rate_annual") @db.Decimal(5, 4)
  termMonths         Int                   @map("term_months")
  monthlyPayment     Decimal               @map("monthly_payment") @db.Decimal(12, 2)
  amortizationSystem AmortizationSystem    @default(SAC) @map("amortization_system")
  createdAt          DateTime              @default(now()) @map("created_at")
  updatedAt          DateTime              @updatedAt @map("updated_at")
  user               User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  simulationConfig   UserSimulationConfig?

  @@index([userId])
  @@index([userId, createdAt])
  @@map("debts")
}

model UserSimulationConfig {
  id              String         @id @default(cuid())
  debtId          String         @unique @map("debt_id")
  monthlyBudget   Decimal        @map("monthly_budget") @db.Decimal(12, 2)
  investmentSplit Decimal        @map("investment_split") @db.Decimal(12, 2)
  strategyType    StrategySource @default(FIXED_RATE) @map("strategy_type")
  manualRateFixed Decimal?       @map("manual_rate_fixed") @db.Decimal(5, 4)
  rankingId       String?        @map("ranking_id")
  manualTickers   String[]       @default([]) @map("manual_tickers")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  monthlyTR       Decimal        @default(0.001) @map("monthly_tr") @db.Decimal(5, 4)
  debt            Debt           @relation(fields: [debtId], references: [id], onDelete: Cascade)

  @@map("user_simulation_configs")
}

model IndexCronCheckpoint {
  id                   String    @id @default(uuid())
  jobType              String
  indexId              String?   @map("index_id")
  lastProcessedIndexId String?   @map("last_processed_index_id")
  processedCount       Int       @default(0) @map("processed_count")
  totalCount           Int       @default(0) @map("total_count")
  errors               Json      @default("[]")
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @updatedAt @map("updated_at")
  completedAt          DateTime? @map("completed_at")

  @@unique([jobType, indexId])
  @@index([jobType])
  @@map("index_cron_checkpoints")
}

model IndexDefinition {
  id            String               @id @default(uuid())
  ticker        String               @unique
  name          String
  description   String
  color         String
  methodology   String
  config        Json
  createdAt     DateTime             @default(now()) @map("created_at")
  updatedAt     DateTime             @updatedAt @map("updated_at")
  composition   IndexComposition[]
  history       IndexHistoryPoints[]
  rebalanceLogs IndexRebalanceLog[]

  @@index([ticker])
  @@index([createdAt])
  @@map("index_definitions")
}

model IndexComposition {
  id           String          @id @default(uuid())
  indexId      String          @map("index_id")
  assetTicker  String          @map("asset_ticker")
  targetWeight Float           @map("target_weight")
  entryPrice   Float           @map("entry_price")
  entryDate    DateTime        @default(now()) @map("entry_date")
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")
  definition   IndexDefinition @relation(fields: [indexId], references: [id], onDelete: Cascade)

  @@unique([indexId, assetTicker])
  @@index([indexId])
  @@index([assetTicker])
  @@map("index_compositions")
}

model IndexHistoryPoints {
  id                  String          @id @default(uuid())
  indexId             String          @map("index_id")
  date                DateTime        @db.Date
  points              Float
  dailyChange         Float           @map("daily_change")
  currentYield        Float?          @map("current_yield")
  createdAt           DateTime        @default(now()) @map("created_at")
  dividendsByTicker   Json?           @map("dividends_by_ticker")
  dividendsReceived   Decimal?        @map("dividends_received") @db.Decimal(15, 6)
  compositionSnapshot Json?           @map("composition_snapshot")
  definition          IndexDefinition @relation(fields: [indexId], references: [id], onDelete: Cascade)

  @@unique([indexId, date])
  @@index([indexId, date])
  @@index([date])
  @@map("index_history_points")
}

model IndexRebalanceLog {
  id         String          @id @default(uuid())
  indexId    String          @map("index_id")
  date       DateTime        @default(now()) @db.Date
  action     String
  ticker     String
  reason     String
  createdAt  DateTime        @default(now()) @map("created_at")
  definition IndexDefinition @relation(fields: [indexId], references: [id], onDelete: Cascade)

  @@index([indexId, date])
  @@index([indexId, action])
  @@index([date])
  @@map("index_rebalance_logs")
}

model AIReportsQueue {
  id              String                     @id @default(cuid())
  companyId       Int                        @map("company_id")
  reportType      AIReportType               @map("report_type")
  triggerReason   Json                       @map("trigger_reason")
  status          QueueStatus                @default(PENDING)
  priority        Int                        @default(0)
  createdAt       DateTime                   @default(now()) @map("created_at")
  processedAt     DateTime?                  @map("processed_at")
  reportId        String?                    @map("report_id")
  errorMessage    String?                    @map("error_message")
  company         Company                    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  report          AIReport?                  @relation("QueueReports", fields: [reportId], references: [id])
  processingSteps AIReportsQueueProcessing[]

  @@index([status, createdAt])
  @@index([status, priority, createdAt])
  @@index([companyId, status])
  @@index([reportType, status])
  @@index([createdAt])
  @@map("ai_reports_queue")
}

model AIReportsQueueProcessing {
  id          String         @id @default(cuid())
  queueId     String         @map("queue_id")
  step        ProcessingStep
  stepData    Json           @map("step_data")
  completedAt DateTime       @default(now()) @map("completed_at")
  queue       AIReportsQueue @relation(fields: [queueId], references: [id], onDelete: Cascade)

  @@unique([queueId, step])
  @@index([queueId])
  @@index([completedAt])
  @@map("ai_reports_queue_processing")
}

model UserAssetMonitor {
  id              String    @id @default(cuid())
  userId          String    @map("user_id")
  companyId       Int       @map("company_id")
  triggerConfig   Json      @map("trigger_config")
  isActive        Boolean   @default(true) @map("is_active")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  lastTriggeredAt DateTime? @map("last_triggered_at")
  isAlertActive   Boolean   @default(false) @map("is_alert_active")
  lastProcessedAt DateTime? @map("last_processed_at")
  company         Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isActive])
  @@index([companyId, isActive])
  @@index([isActive, lastTriggeredAt])
  @@index([isActive, isAlertActive])
  @@index([isActive, lastProcessedAt])
  @@index([createdAt])
  @@map("user_asset_monitor")
}

model CompanyFlag {
  id                String                  @id @default(cuid())
  companyId         Int                      @map("company_id")
  reportId          String                   @map("report_id")
  flagType          FlagType                 @map("flag_type")
  reason            String
  isActive          Boolean                  @default(true) @map("is_active")
  createdAt         DateTime                 @default(now()) @map("created_at")
  lastReevaluatedAt DateTime?                @map("last_reevaluated_at")
  reevaluationCount Int                      @default(0) @map("reevaluation_count")
  company           Company                  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  report            AIReport                 @relation("FlagReports", fields: [reportId], references: [id], onDelete: Cascade)
  queueEntries      CompanyFlagsQueue[]

  @@index([companyId, isActive])
  @@index([reportId])
  @@index([flagType, isActive])
  @@index([createdAt])
  @@index([isActive, createdAt])
  @@map("company_flags")
}

enum TransactionType {
  CASH_CREDIT
  CASH_DEBIT
  BUY
  SELL_REBALANCE
  BUY_REBALANCE
  SELL_WITHDRAWAL
  DIVIDEND
  MONTHLY_CONTRIBUTION
}

enum TransactionStatus {
  PENDING
  CONFIRMED
  EXECUTED
  REJECTED
}

enum SubscriptionTier {
  FREE
  PREMIUM
}

enum ReportPeriod {
  YEARLY
  QUARTERLY
}

enum ProcessingPhase {
  DISCOVERING
  PROCESSING_HISTORICAL
  PROCESSING_TTM
  COMPLETED
  ERROR
}

enum TickerStatus {
  PENDING
  PROCESSING
  COMPLETED
  PARTIAL
  ERROR
  SKIPPED
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  WAITING_USER
  WAITING_ADMIN
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TicketCategory {
  GENERAL
  TECHNICAL
  BILLING
  FEATURE_REQUEST
  BUG_REPORT
  ACCOUNT
}

enum FeedbackType {
  LIKE
  DISLIKE
}

enum ReportStatus {
  GENERATING
  COMPLETED
  FAILED
}

enum AIReportType {
  MONTHLY_OVERVIEW
  FUNDAMENTAL_CHANGE
  PRICE_VARIATION
  CUSTOM_TRIGGER
}

enum AssetType {
  STOCK
  ETF
  FII
  BDR
  INDEX
  OTHER
}

enum EmailType {
  ASSET_CHANGE
  MONTHLY_REPORT
  PASSWORD_RESET
  WELCOME
  PAYMENT_FAILURE
  EMAIL_VERIFICATION
  FREE_USER_ASSET_CHANGE
  NOTIFICATION
  SUBSCRIPTION_CONFIRMATION
  PRICE_VARIATION_REPORT
  CUSTOM_TRIGGER_REPORT
  PREMIUM_EXPIRED
}

enum EmailStatus {
  PENDING
  SENT
  FAILED
}

enum EventType {
  PAGE_VIEW
  CLICK
  SCROLL
  TIME_ON_PAGE
  NAVIGATION
  FORM_SUBMIT
  FEATURE_USED
  ASSET_VIEWED
  RANKING_CREATED
  BACKTEST_RUN
  COMPARISON_STARTED
  SEARCH
  DOWNLOAD
  ERROR
}

enum WebhookProvider {
  STRIPE
  MERCADOPAGO
}

enum WebhookEventStatus {
  PENDING
  PROCESSING
  DONE
  FAILED
}

enum OfferType {
  MONTHLY
  ANNUAL
  SPECIAL
}

enum BlogPostStatus {
  DRAFT
  PUBLISHED
}

enum AmortizationSystem {
  SAC
  PRICE
}

enum StrategySource {
  FIXED_RATE
  PORTFOLIO
  RANKING
  MANUAL_TICKERS
}

enum NotificationType {
  SYSTEM
  CAMPAIGN
  ASSET_CHANGE
  MONTHLY_REPORT
  AI_REPORT
  QUIZ
  MODAL
}

enum NotificationDisplayType {
  BANNER
  MODAL
  QUIZ
}

enum NotificationTemplate {
  GRADIENT
  SOLID
  MINIMAL
  ILLUSTRATED
}

enum NotificationLinkType {
  INTERNAL
  EXTERNAL
}

enum NotificationSegmentType {
  ALL_USERS
  ASSET_SUBSCRIBERS
  RECENT_RANKING_CREATORS
  RECENT_RADAR_USERS
  RECENT_BACKTEST_USERS
  RECENT_PORTFOLIO_CREATORS
  ACTIVE_PORTFOLIO_USERS
  PREMIUM_USERS
  FREE_USERS
  EARLY_ADOPTERS
  TRIAL_USERS
  RECENT_LOGINS
  NEW_USERS
  FEATURE_USERS
  SUPPORT_TICKET_USERS
  EMAIL_LIST
  DASHBOARD_NEW_USERS
}

enum EmailProvider {
  RESEND
  GMAIL
}

enum QueueStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum ProcessingStep {
  RESEARCH
  ANALYSIS
  COMPILATION
}

enum FlagType {
  FUNDAMENTAL_LOSS
}

model CompanyFlagsQueue {
  id              String                        @id @default(cuid())
  flagId          String                        @map("flag_id")
  status          QueueStatus                   @default(PENDING)
  priority        Int                           @default(0)
  createdAt       DateTime                      @default(now()) @map("created_at")
  processedAt     DateTime?                     @map("processed_at")
  errorMessage    String?                       @map("error_message")
  flag            CompanyFlag                   @relation(fields: [flagId], references: [id], onDelete: Cascade)
  processingSteps CompanyFlagsQueueProcessing[]

  @@index([status, createdAt])
  @@index([status, priority, createdAt])
  @@index([flagId, status])
  @@index([createdAt])
  @@map("company_flags_queue")
}

model CompanyFlagsQueueProcessing {
  id          String                  @id @default(cuid())
  queueId     String                  @map("queue_id")
  step        FlagReevaluationStep
  stepData    Json                    @map("step_data")
  completedAt DateTime                @default(now()) @map("completed_at")
  queue       CompanyFlagsQueue       @relation(fields: [queueId], references: [id], onDelete: Cascade)

  @@unique([queueId, step])
  @@index([queueId])
  @@index([completedAt])
  @@map("company_flags_queue_processing")
}

enum FlagReevaluationStep {
  RESEARCH
  ANALYSIS
  EVALUATION
}
